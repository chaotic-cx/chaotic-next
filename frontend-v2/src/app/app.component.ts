import { Component, OnInit } from '@angular/core';
import { RouterModule, RouterOutlet } from '@angular/router';
import { PrimeNG } from 'primeng/config';
import TimeAgo from 'javascript-time-ago';
import en from 'javascript-time-ago/locale/en.json';
import { CAUR_CACHED_METRICS_URL } from '@./shared-lib';
import { HttpClient } from '@angular/common/http';
import { MenubarComponent } from './menubar/menubar.component';
import { routeAnimations } from './app.routes';

@Component({
  imports: [RouterModule, MenubarComponent],
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrl: './app.component.css',
  animations: [routeAnimations],
})
export class AppComponent implements OnInit {
  title = 'Chaotic-AUR';

  constructor(
    private httpClient: HttpClient,
    private primeng: PrimeNG,
  ) {}

  ngOnInit() {
    TimeAgo.addDefaultLocale(en);

    // Cause stat metrics to be pre-generated by calling its URL,
    // which are then cached in the backend for 5 minutes
    const routesToPreCache = [
      '30d/users',
      '30d/packages',
      '30d/rank/30/packages',
      '30d/rank/30/countries',
      '30d/user-agents',
    ];
    for (const route of routesToPreCache) {
      this.httpClient.get(CAUR_CACHED_METRICS_URL + route);
    }
  }

  /**
   * Returns the animation state of the next page for page transitions
   * @param outlet Router outlet element
   * @returns The animation state of the target route
   */
  prepareRoute(outlet: RouterOutlet): string {
    return outlet.activatedRouteData['animationState'];
  }
}
